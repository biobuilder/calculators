## Copyright (C) 2020 damon
## 
## This program is free software: you can redistribute it and/or modify it
## under the terms of the GNU General Public License as published by
## the Free Software Foundation, either version 3 of the License, or
## (at your option) any later version.
## 
## This program is distributed in the hope that it will be useful, but
## WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
## 
## You should have received a copy of the GNU General Public License
## along with this program.  If not, see
## <https://www.gnu.org/licenses/>.

## -*- texinfo -*- 
## @deftypefn {} {@var{retval} =} q_calc (@var{input1}, @var{input2})
##
## @seealso{}
## @end deftypefn

## Author: damon <damon@FUNRIG>
## Created: 2020-03-06

% dynamic pressure assist calculator
% select a planet, input altitude
% outputs temperature T, pressure P, and density Rho for selected planet 
% also outputs ratio of specific heats gamma and R gas constant

function [T, p, rho, gamma, R] = atmosphere (altitude, planet)


% columns of altData:
% Altitude (m), Pressure (Pa), Pressure (atm), Density (kg/m^2), Temperature (K)
altData = zeros(17,5);
maxAlt = 0;
gamma = 0; % ratio of specific heat 
R = 0; % Gas constant for the atmosphere [J/kg deg K]

if(planet == 'k') % Kerbin

altData = ...
[0	    101325	  1.000	    1.225   290; ...
2500	  69015	    0.681	    0.898   275; ...
5000	  45625	    0.450	    0.642   255; ...
7500	  29126	    0.287	    0.446   235; ...
10000	  17934	    0.177	    0.288   210; ...
15000	  6726	    0.066	    0.108   218; ...
20000	  2549	    0.025	    0.040   220; ...
25000	  993.6	    0.010	    0.015   228; ...
30000	  404.1	    0.004	    0.006   240; ...
40000	  79.77	    0.001	    0.001   272; ...
50000	  15.56	    0.000	    0.000   245; ...
60000	  2.387	    0.000	    0.000   205; ...
70000	  0.000	    0.000	    0.000   185];

maxAlt = 70000; % m
gamma = 1.4; % specific heat ratio of Kerbin's atmosphere
R = 287.1; % J/kg deg K

elseif(planet == 'e') % Eve

altData = [...
0	      506625	  5.000   0   415;...
2500	  403913	  3.986   0   385;...
5000	  316277	  3.121   0   350;...
7500	  242677	  2.395   0   335;...
10000	  182072	  1.797   0   310;...
12500	  133423	  1.317   0   300;...
15000	  95689	    0.944   0   280;...
20000	  44335	    0.438   0   260;...
25000	  18073	    0.178   0   240;...
30000	  8233	    0.081   0   220;...
35000	  5196	    0.051   0   200;...
40000	  3500	    0.035   0   185;...
50000	  121.8	    0.001   0   175;...
60000	  23.00	    0.000   0   180;...
70000	  4.344	    0.000   0   140;...
80000	  0.8205	  0.000   0   170;...
90000	  0	        0.000   0   220];

maxAlt = 90000;

gamma = 1.2; % specific heat ratio of air
R = 193.4; % J/kg deg K

elseif(planet == 'd') % Duna

altData = [...
0	    6755	0.067 0 250;...
2500	5136	0.051 0 245;...
5000	3774	0.037 0 237;...
7500	2663	0.026 0 230;...
10000	1797	0.018 0 220;...
15000	716.9	0.007 0 195;...
20000	241.0	0.002 0 170;...
25000	91.73	0.001 0 155;...
30000	32.90	0.000 0 150;...
40000	4.918	0.000 0 150;...
46000 0.9   0.000 0 150;...
50000	0	    0.000 0 177;...
];
maxAlt = 50000;

gamma = 1.20; % specific heat ratio of air
R = 197.96; % J/kg deg K

elseif(planet == 'j') % Jool
altData = [...
0	      5066250	  50.000  0   205;...
10000	  1519875	  15.000  0   200;...
20000	  772776	  7.627   0   190;...
30000	  613670	  6.056   0   180;...
40000	  482628	  4.763   0   170;...
50000	  373138	  3.683   0   165;...
60000	  283031	  2.793   0   155;...
70000	  210136	  2.074   0   150;...
80000	  152282	  1.503   0   145;...
90000	  107299	  1.059   0   140;...
100000	73016	    0.721   0   139;...
110000	47263	    0.466   0   139;...
120000	27869	    0.275   0   139;...
130000	13529	    0.134   0   142;...
140000	5319	    0.052   0   149;...
150000	2000	    0.020   0   160;...
160000	734.7	    0.007   0   175;...
170000	100.0	    0.001   0   188;...
180000	29.57	    0.000   0   201;...
190000	3.675	    0.000   0   205;...
200000	0	        0.000   0   360];

maxAlt = 200000;

gamma = 1.43; % specific heat ratio of air
R = 3779.3; % J/kg deg K

elseif(planet == 'l') % Laythe

altData = [...
0	    60795	0.600 0 282;...
2500	47153	0.465 0 252;...
5000	34495	0.340 0 212;...
7500	24914	0.246 0 205;...
10000	17786	0.176 0 210;...
15000	9351	0.092 0 215;...
20000	4782	0.047 0 227;...
25000	2671	0.026 0 235;...
30000	1507	0.015 0 210;...
32500 1000  0.010 0 201;...
40000	363.5	0.004 0 205;...
50000	0	    0.000 0 220];

maxAlt = 50000;

gamma = 1.40; % specific heat ratio of air
R = 287.06; % J/kg deg K
else 
maxAlt = 0; % set to a planet without atmosphere
endif 

% calculates the air pressure and density 
% at different altitudes for the given dataset
if(altitude < maxAlt && altitude >= 0)
  T = interp1(altData(:,1),altData(:,5),altitude);
  p = interp1(altData(:,1),altData(:,2),altitude);
  rho = interp1(altData(:,1),altData(:,4),altitude);
else 
  T = 0;
  p = 0;
  rho = 0;
endif 




endfunction
